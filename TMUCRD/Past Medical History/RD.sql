SELECT DISTINCT *
INTO OPD_RD
FROM(
	SELECT
		t1.ID_no, t.CHR_NO, t.FEE_NO,
		t.ICD10_CODE1, t.ICD10_CODE2, t.ICD10_CODE3, 
		t.ICD10_CODE4, t.ICD10_CODE5, t.ICD9_CODE1, 
		t.ICD9_CODE2, t.ICD9_CODE3, t.ICD9_CODE4, t.ICD9_CODE5
	FROM v_opd_basic_s t
	INNER JOIN v_chr_basic_s t1
	ON t.chr_no = t1.CHR_NO
union all
	SELECT
		t1.ID_no, t.CHR_NO, t.FEE_NO, 
		t.ICD10_CODE1, t.ICD10_CODE2, t.ICD10_CODE3, 
		t.ICD10_CODE4, t.ICD10_CODE5, t.ICD9_CODE1, 
		t.ICD9_CODE2, t.ICD9_CODE3, t.ICD9_CODE4, t.ICD9_CODE5
	FROM v_opd_basic_t t
	INNER JOIN v_chr_basic_T t1
	ON t.chr_no = t1.CHR_NO
union all
	SELECT
		t1.ID_no, t.CHR_NO, t.FEE_NO, 
		t.ICD10_CODE1, t.ICD10_CODE2, t.ICD10_CODE3, 
		t.ICD10_CODE4, t.ICD10_CODE5, t.ICD9_CODE1, 
		t.ICD9_CODE2, t.ICD9_CODE3, t.ICD9_CODE4, t.ICD9_CODE5
	FROM v_opd_basic_w t
	INNER JOIN v_chr_basic_W t1
	ON t.chr_no = t1.CHR_NO
) as temp
where 
	ICD9_CODE1 like '403.[019]1' or ICD9_CODE1 like '404.[019][23]' or ICD9_CODE1 like '582%' or ICD9_CODE1 like '583.[0-7]'
	or ICD9_CODE1 like '58[56]%' or ICD9_CODE1 like '588.0' OR
	ICD9_CODE2 like '403.[019]1' or ICD9_CODE2 like '404.[019][23]' or ICD9_CODE2 like '582%' or ICD9_CODE2 like '583.[0-7]'
	or ICD9_CODE2 like '58[56]%' or ICD9_CODE2 like '588.0' OR
	ICD9_CODE3 like '403.[019]1' or ICD9_CODE3 like '404.[019][23]' or ICD9_CODE3 like '582%' or ICD9_CODE3 like '583.[0-7]'
	or ICD9_CODE3 like '58[56]%' or ICD9_CODE3 like '588.0' OR
	ICD9_CODE4 like '403.[019]1' or ICD9_CODE4 like '404.[019][23]' or ICD9_CODE4 like '582%' or ICD9_CODE4 like '583.[0-7]'
	or ICD9_CODE4 like '58[56]%' or ICD9_CODE4 like '588.0' OR
	ICD9_CODE5 like '403.[019]1' or ICD9_CODE5 like '404.[019][23]' or ICD9_CODE5 like '582%' or ICD9_CODE5 like '583.[0-7]'
	or ICD9_CODE5 like '58[56]%' or ICD9_CODE5 like '588.0' OR
	ICD10_CODE1 like 'V42.0' or ICD10_CODE1 like 'V45.1' or ICD10_CODE1 like 'V56%' or ICD10_CODE1 like 'I12.0'
	or ICD10_CODE1 like 'N0[35].[2-7]' or ICD10_CODE1 like 'N1[89]%' or ICD10_CODE1 like 'N25.0' or ICD10_CODE1 like 'Z49.[0-2]'
	or ICD10_CODE1 like 'Z94.0' or ICD10_CODE1 like 'Z99.2' or ICD10_CODE1 like 'I13.1' OR
	ICD10_CODE2 like 'V42.0' or ICD10_CODE2 like 'V45.1' or ICD10_CODE2 like 'V56%' or ICD10_CODE2 like 'I12.0'
	or ICD10_CODE2 like 'N0[35].[2-7]' or ICD10_CODE2 like 'N1[89]%' or ICD10_CODE2 like 'N25.0' or ICD10_CODE2 like 'Z49.[0-2]'
	or ICD10_CODE2 like 'Z94.0' or ICD10_CODE2 like 'Z99.2' or ICD10_CODE2 like 'I13.1' OR
	ICD10_CODE3 like 'V42.0' or ICD10_CODE3 like 'V45.1' or ICD10_CODE3 like 'V56%' or ICD10_CODE3 like 'I12.0'
	or ICD10_CODE3 like 'N0[35].[2-7]' or ICD10_CODE3 like 'N1[89]%' or ICD10_CODE3 like 'N25.0' or ICD10_CODE3 like 'Z49.[0-2]'
	or ICD10_CODE3 like 'Z94.0' or ICD10_CODE3 like 'Z99.2' or ICD10_CODE3 like 'I13.1' OR
	ICD10_CODE4 like 'V42.0' or ICD10_CODE4 like 'V45.1' or ICD10_CODE4 like 'V56%' or ICD10_CODE4 like 'I12.0'
	or ICD10_CODE4 like 'N0[35].[2-7]' or ICD10_CODE4 like 'N1[89]%' or ICD10_CODE4 like 'N25.0' or ICD10_CODE4 like 'Z49.[0-2]'
	or ICD10_CODE4 like 'Z94.0' or ICD10_CODE4 like 'Z99.2' or ICD10_CODE4 like 'I13.1' OR
	ICD10_CODE5 like 'V42.0' or ICD10_CODE5 like 'V45.1' or ICD10_CODE5 like 'V56%' or ICD10_CODE5 like 'I12.0'
	or ICD10_CODE5 like 'N0[35].[2-7]' or ICD10_CODE5 like 'N1[89]%' or ICD10_CODE5 like 'N25.0' or ICD10_CODE5 like 'Z49.[0-2]'
	or ICD10_CODE5 like 'Z94.0' or ICD10_CODE5 like 'Z99.2' or ICD10_CODE5 like 'I13.1'

SELECT DISTINCT*
INTO IPD_RD
FROM(
	SELECT
		t1.ID_no, t.CHR_NO, t.FEE_NO,
		t.EDIAG_CODE, T.ESDIAG_CODE1, T.ESDIAG_CODE2, 
		T.ESDIAG_CODE3, T.ESDIAG_CODE4, MDIAG_CODE,
		T.SDIAG_CODE1, T.SDIAG_CODE2, T.SDIAG_CODE3,
		T.SDIAG_CODE4, T.SDIAG_CODE5, T.SDIAG_CODE6,
		T.SDIAG_CODE7, T.ICD10_CODE1, T.ICD10_CODE2, 
		T.ICD10_CODE3, T.ICD10_CODE4, T.ICD10_CODE5,
		T.ICD10_CODE6, T.ICD10_CODE7, T.ICD10_CODE1_OUT, 
		T.ICD10_CODE2_OUT, T.ICD10_CODE3_OUT, T.ICD10_CODE4_OUT, 
		T.ICD10_CODE5_OUT, T.ICD10_CODE6_OUT, T.ICD10_CODE7_OUT,
		T.ICD10_CODE8_OUT		
	FROM v_ipd_basic_s t
	INNER JOIN v_chr_basic_s t1
	ON t.chr_no = t1.CHR_NO
union all
	SELECT
		t1.ID_no, t.CHR_NO, t.FEE_NO,
		t.EDIAG_CODE, T.ESDIAG_CODE1, T.ESDIAG_CODE2, 
		T.ESDIAG_CODE3, T.ESDIAG_CODE4, MDIAG_CODE,
		T.SDIAG_CODE1, T.SDIAG_CODE2, T.SDIAG_CODE3,
		T.SDIAG_CODE4, T.SDIAG_CODE5, T.SDIAG_CODE6,
		T.SDIAG_CODE7, T.ICD10_CODE1, T.ICD10_CODE2, 
		T.ICD10_CODE3, T.ICD10_CODE4, T.ICD10_CODE5,
		T.ICD10_CODE6, T.ICD10_CODE7, T.ICD10_CODE1_OUT, 
		T.ICD10_CODE2_OUT, T.ICD10_CODE3_OUT, T.ICD10_CODE4_OUT, 
		T.ICD10_CODE5_OUT, T.ICD10_CODE6_OUT, T.ICD10_CODE7_OUT,
		T.ICD10_CODE8_OUT
	FROM v_ipd_basic_t t
	INNER JOIN v_chr_basic_T t1
	ON t.chr_no = t1.CHR_NO
union all
	SELECT
		t1.ID_no, t.CHR_NO, t.FEE_NO,
		t.EDIAG_CODE, T.ESDIAG_CODE1, T.ESDIAG_CODE2, 
		T.ESDIAG_CODE3, T.ESDIAG_CODE4, MDIAG_CODE,
		T.SDIAG_CODE1, T.SDIAG_CODE2, T.SDIAG_CODE3,
		T.SDIAG_CODE4, T.SDIAG_CODE5, T.SDIAG_CODE6,
		T.SDIAG_CODE7, T.ICD10_CODE1, T.ICD10_CODE2, 
		T.ICD10_CODE3, T.ICD10_CODE4, T.ICD10_CODE5,
		T.ICD10_CODE6, T.ICD10_CODE7, T.ICD10_CODE1_OUT, 
		T.ICD10_CODE2_OUT, T.ICD10_CODE3_OUT, T.ICD10_CODE4_OUT, 
		T.ICD10_CODE5_OUT, T.ICD10_CODE6_OUT, T.ICD10_CODE7_OUT,
		T.ICD10_CODE8_OUT
	FROM v_ipd_basic_w t
	INNER JOIN v_chr_basic_W t1
	ON t.chr_no = t1.CHR_NO
) as temp
where 
	EDIAG_CODE like '403.[019]1' OR EDIAG_CODE like '404.[019][23]' OR EDIAG_CODE like '582%' OR EDIAG_CODE like '583.[0-7]'
	OR EDIAG_CODE like '58[56]%' OR EDIAG_CODE like '588.0' OR
	ESDIAG_CODE1 like '403.[019]1' OR ESDIAG_CODE1 like '404.[019][23]' OR ESDIAG_CODE1 like '582%' OR ESDIAG_CODE1 like '583.[0-7]'
	OR ESDIAG_CODE1 like '58[56]%' OR ESDIAG_CODE1 like '588.0' OR
	ESDIAG_CODE2 like '403.[019]1' OR ESDIAG_CODE2 like '404.[019][23]' OR ESDIAG_CODE2 like '582%' OR ESDIAG_CODE2 like '583.[0-7]'
	OR ESDIAG_CODE2 like '58[56]%' OR ESDIAG_CODE2 like '588.0' OR
	ESDIAG_CODE3 like '403.[019]1' OR ESDIAG_CODE3 like '404.[019][23]' OR ESDIAG_CODE3 like '582%' OR ESDIAG_CODE3 like '583.[0-7]'
	OR ESDIAG_CODE3 like '58[56]%' OR ESDIAG_CODE3 like '588.0' OR
	ESDIAG_CODE4 like '403.[019]1' OR ESDIAG_CODE4 like '404.[019][23]' OR ESDIAG_CODE4 like '582%' OR ESDIAG_CODE4 like '583.[0-7]'
	OR ESDIAG_CODE4 like '58[56]%' OR ESDIAG_CODE4 like '588.0' OR
	MDIAG_CODE like '403.[019]1' OR MDIAG_CODE like '404.[019][23]' OR MDIAG_CODE like '582%' OR MDIAG_CODE like '583.[0-7]'
	OR MDIAG_CODE like '58[56]%' OR MDIAG_CODE like '588.0' OR
	SDIAG_CODE1 like '403.[019]1' OR SDIAG_CODE1 like '404.[019][23]' OR SDIAG_CODE1 like '582%' OR SDIAG_CODE1 like '583.[0-7]'
	OR SDIAG_CODE1 like '58[56]%' OR SDIAG_CODE1 like '588.0' OR
	SDIAG_CODE2 like '403.[019]1' OR SDIAG_CODE2 like '404.[019][23]' OR SDIAG_CODE2 like '582%' OR SDIAG_CODE2 like '583.[0-7]'
	OR SDIAG_CODE2 like '58[56]%' OR SDIAG_CODE2 like '588.0' OR
	SDIAG_CODE3 like '403.[019]1' OR SDIAG_CODE3 like '404.[019][23]' OR SDIAG_CODE3 like '582%' OR SDIAG_CODE3 like '583.[0-7]'
	OR SDIAG_CODE3 like '58[56]%' OR SDIAG_CODE3 like '588.0' OR
	SDIAG_CODE4 like '403.[019]1' OR SDIAG_CODE4 like '404.[019][23]' OR SDIAG_CODE4 like '582%' OR SDIAG_CODE4 like '583.[0-7]'
	OR SDIAG_CODE4 like '58[56]%' OR SDIAG_CODE4 like '588.0' OR
	SDIAG_CODE5 like '403.[019]1' OR SDIAG_CODE5 like '404.[019][23]' OR SDIAG_CODE5 like '582%' OR SDIAG_CODE5 like '583.[0-7]'
	OR SDIAG_CODE5 like '58[56]%' OR SDIAG_CODE5 like '588.0' OR
	SDIAG_CODE6 like '403.[019]1' OR SDIAG_CODE6 like '404.[019][23]' OR SDIAG_CODE6 like '582%' OR SDIAG_CODE6 like '583.[0-7]'
	OR SDIAG_CODE6 like '58[56]%' OR SDIAG_CODE6 like '588.0' OR
	SDIAG_CODE7 like '403.[019]1' OR SDIAG_CODE7 like '404.[019][23]' OR SDIAG_CODE7 like '582%' OR SDIAG_CODE7 like '583.[0-7]'
	OR SDIAG_CODE7 like '58[56]%' OR SDIAG_CODE7 like '588.0' OR
	ICD10_CODE1 like 'V42.0' OR ICD10_CODE1 like 'V45.1' OR ICD10_CODE1 like 'V56%' OR ICD10_CODE1 like 'I12.0'
	OR ICD10_CODE1 like 'I13.1' OR ICD10_CODE1 like 'N0[35].[2-7]' OR ICD10_CODE1 like 'N1[89]%' OR ICD10_CODE1 like 'N25.0' 
	OR ICD10_CODE1 like 'Z49.[0-2]' OR ICD10_CODE1 like 'Z94.0' OR ICD10_CODE1 like 'Z99.2' OR
	ICD10_CODE2 like 'V42.0' OR ICD10_CODE2 like 'V45.1' OR ICD10_CODE2 like 'V56%' OR ICD10_CODE2 like 'I12.0'
	OR ICD10_CODE2 like 'I13.1' OR ICD10_CODE2 like 'N0[35].[2-7]' OR ICD10_CODE2 like 'N1[89]%' OR ICD10_CODE2 like 'N25.0' 
	OR ICD10_CODE2 like 'Z49.[0-2]' OR ICD10_CODE2 like 'Z94.0' OR ICD10_CODE2 like 'Z99.2' OR
	ICD10_CODE3 like 'V42.0' OR ICD10_CODE3 like 'V45.1' OR ICD10_CODE3 like 'V56%' OR ICD10_CODE3 like 'I12.0'
	OR ICD10_CODE3 like 'I13.1' OR ICD10_CODE3 like 'N0[35].[2-7]' OR ICD10_CODE3 like 'N1[89]%' OR ICD10_CODE3 like 'N25.0' 
	OR ICD10_CODE3 like 'Z49.[0-2]' OR ICD10_CODE3 like 'Z94.0' OR ICD10_CODE3 like 'Z99.2' OR
	ICD10_CODE4 like 'V42.0' OR ICD10_CODE4 like 'V45.1' OR ICD10_CODE4 like 'V56%' OR ICD10_CODE4 like 'I12.0'
	OR ICD10_CODE4 like 'I13.1' OR ICD10_CODE4 like 'N0[35].[2-7]' OR ICD10_CODE4 like 'N1[89]%' OR ICD10_CODE4 like 'N25.0' 
	OR ICD10_CODE4 like 'Z49.[0-2]' OR ICD10_CODE4 like 'Z94.0' OR ICD10_CODE4 like 'Z99.2' OR
	ICD10_CODE5 like 'V42.0' OR ICD10_CODE5 like 'V45.1' OR ICD10_CODE5 like 'V56%' OR ICD10_CODE5 like 'I12.0'
	OR ICD10_CODE5 like 'I13.1' OR ICD10_CODE5 like 'N0[35].[2-7]' OR ICD10_CODE5 like 'N1[89]%' OR ICD10_CODE5 like 'N25.0' 
	OR ICD10_CODE5 like 'Z49.[0-2]' OR ICD10_CODE5 like 'Z94.0' OR ICD10_CODE5 like 'Z99.2' OR
	ICD10_CODE6 like 'V42.0' OR ICD10_CODE6 like 'V45.1' OR ICD10_CODE6 like 'V56%' OR ICD10_CODE6 like 'I12.0'
	OR ICD10_CODE6 like 'I13.1' OR ICD10_CODE6 like 'N0[35].[2-7]' OR ICD10_CODE6 like 'N1[89]%' OR ICD10_CODE6 like 'N25.0' 
	OR ICD10_CODE6 like 'Z49.[0-2]' OR ICD10_CODE6 like 'Z94.0' OR ICD10_CODE6 like 'Z99.2' OR
	ICD10_CODE7 like 'V42.0' OR ICD10_CODE7 like 'V45.1' OR ICD10_CODE7 like 'V56%' OR ICD10_CODE7 like 'I12.0'
	OR ICD10_CODE7 like 'I13.1' OR ICD10_CODE7 like 'N0[35].[2-7]' OR ICD10_CODE7 like 'N1[89]%' OR ICD10_CODE7 like 'N25.0' 
	OR ICD10_CODE7 like 'Z49.[0-2]' OR ICD10_CODE7 like 'Z94.0' OR ICD10_CODE7 like 'Z99.2' OR
	ICD10_CODE1_OUT like 'V42.0' OR ICD10_CODE1_OUT like 'V45.1' OR ICD10_CODE1_OUT like 'V56%' OR ICD10_CODE1_OUT like 'I12.0'
	OR ICD10_CODE1_OUT like 'I13.1' OR ICD10_CODE1_OUT like 'N0[35].[2-7]' OR ICD10_CODE1_OUT like 'N1[89]%' OR ICD10_CODE1_OUT like 'N25.0' 
	OR ICD10_CODE1_OUT like 'Z49.[0-2]' OR ICD10_CODE1_OUT like 'Z94.0' OR ICD10_CODE1_OUT like 'Z99.2' OR
	ICD10_CODE2_OUT like 'V42.0' OR ICD10_CODE2_OUT like 'V45.1' OR ICD10_CODE2_OUT like 'V56%' OR ICD10_CODE2_OUT like 'I12.0'
	OR ICD10_CODE2_OUT like 'I13.1' OR ICD10_CODE2_OUT like 'N0[35].[2-7]' OR ICD10_CODE2_OUT like 'N1[89]%' OR ICD10_CODE2_OUT like 'N25.0' 
	OR ICD10_CODE2_OUT like 'Z49.[0-2]' OR ICD10_CODE2_OUT like 'Z94.0' OR ICD10_CODE2_OUT like 'Z99.2' OR
	ICD10_CODE3_OUT like 'V42.0' OR ICD10_CODE3_OUT like 'V45.1' OR ICD10_CODE3_OUT like 'V56%' OR ICD10_CODE3_OUT like 'I12.0'
	OR ICD10_CODE3_OUT like 'I13.1' OR ICD10_CODE3_OUT like 'N0[35].[2-7]' OR ICD10_CODE3_OUT like 'N1[89]%' OR ICD10_CODE3_OUT like 'N25.0' 
	OR ICD10_CODE3_OUT like 'Z49.[0-2]' OR ICD10_CODE3_OUT like 'Z94.0' OR ICD10_CODE3_OUT like 'Z99.2' OR
	ICD10_CODE4_OUT like 'V42.0' OR ICD10_CODE4_OUT like 'V45.1' OR ICD10_CODE4_OUT like 'V56%' OR ICD10_CODE4_OUT like 'I12.0'
	OR ICD10_CODE4_OUT like 'I13.1' OR ICD10_CODE4_OUT like 'N0[35].[2-7]' OR ICD10_CODE4_OUT like 'N1[89]%' OR ICD10_CODE4_OUT like 'N25.0' 
	OR ICD10_CODE4_OUT like 'Z49.[0-2]' OR ICD10_CODE4_OUT like 'Z94.0' OR ICD10_CODE4_OUT like 'Z99.2' OR
	ICD10_CODE5_OUT like 'V42.0' OR ICD10_CODE5_OUT like 'V45.1' OR ICD10_CODE5_OUT like 'V56%' OR ICD10_CODE5_OUT like 'I12.0'
	OR ICD10_CODE5_OUT like 'I13.1' OR ICD10_CODE5_OUT like 'N0[35].[2-7]' OR ICD10_CODE5_OUT like 'N1[89]%' OR ICD10_CODE5_OUT like 'N25.0' 
	OR ICD10_CODE5_OUT like 'Z49.[0-2]' OR ICD10_CODE5_OUT like 'Z94.0' OR ICD10_CODE5_OUT like 'Z99.2' OR
	ICD10_CODE6_OUT like 'V42.0' OR ICD10_CODE6_OUT like 'V45.1' OR ICD10_CODE6_OUT like 'V56%' OR ICD10_CODE6_OUT like 'I12.0'
	OR ICD10_CODE6_OUT like 'I13.1' OR ICD10_CODE6_OUT like 'N0[35].[2-7]' OR ICD10_CODE6_OUT like 'N1[89]%' OR ICD10_CODE6_OUT like 'N25.0' 
	OR ICD10_CODE6_OUT like 'Z49.[0-2]' OR ICD10_CODE6_OUT like 'Z94.0' OR ICD10_CODE6_OUT like 'Z99.2' OR
	ICD10_CODE7_OUT like 'V42.0' OR ICD10_CODE7_OUT like 'V45.1' OR ICD10_CODE7_OUT like 'V56%' OR ICD10_CODE7_OUT like 'I12.0'
	OR ICD10_CODE7_OUT like 'I13.1' OR ICD10_CODE7_OUT like 'N0[35].[2-7]' OR ICD10_CODE7_OUT like 'N1[89]%' OR ICD10_CODE7_OUT like 'N25.0' 
	OR ICD10_CODE7_OUT like 'Z49.[0-2]' OR ICD10_CODE7_OUT like 'Z94.0' OR ICD10_CODE7_OUT like 'Z99.2' OR
	ICD10_CODE8_OUT like 'V42.0' OR ICD10_CODE8_OUT like 'V45.1' OR ICD10_CODE8_OUT like 'V56%' OR ICD10_CODE8_OUT like 'I12.0'
	OR ICD10_CODE8_OUT like 'I13.1' OR ICD10_CODE8_OUT like 'N0[35].[2-7]' OR ICD10_CODE8_OUT like 'N1[89]%' OR ICD10_CODE8_OUT like 'N25.0' 
	OR ICD10_CODE8_OUT like 'Z49.[0-2]' OR ICD10_CODE8_OUT like 'Z94.0' OR ICD10_CODE8_OUT like 'Z99.2'
	

SELECT ID_NO, COUNT(FEE_NO) AS VISITS_TIMES
INTO LUNGCA_FINAL_RD
FROM(
	SELECT t.ID_NO, t.FEE_NO
	FROM IPD_RD T
UNION ALL
	SELECT t1.ID_NO, t1.FEE_NO
	FROM OPD_RD T1
) AS TEMP
GROUP BY ID_NO
HAVING COUNT(FEE_NO) > 1

DROP TABLE LUNGCA_FINAL_RD

SELECT DISTINCT T2.FEE_NO,T2.ID_NO
INTO LUNGCA_FINAL_RD
FROM (
    SELECT ID_NO
    FROM(
        SELECT t.ID_NO, t.FEE_NO
        FROM IPD_RD T
    UNION ALL
        SELECT t1.ID_NO, t1.FEE_NO
        FROM OPD_RD T1
    ) AS TEMP
    GROUP BY ID_NO
    HAVING COUNT(FEE_NO) > 1
) T1
INNER JOIN (
    SELECT ID_NO, FEE_NO
    FROM IPD_RD
    UNION ALL
    SELECT ID_NO, FEE_NO
    FROM OPD_RD
) T2 ON T1.ID_NO = T2.ID_NO